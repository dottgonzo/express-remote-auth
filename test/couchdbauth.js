"use strict";
var expect = require("chai").expect;
var express = require("express");
var superagent = require("superagent");
var index_1 = require("../index");
var app = express();
var server = require("http").Server(app);
before(function () {
    app.use('/auth', index_1.default({ secret: "tt", app_id: "energytrack", couchdb: "https://couchman.kernel.online" }));
    server.listen(21569);
});
describe("authorize with couchdb", function () {
    describe("authorization object", function () {
        this.timeout(30000);
        it("verificate authorization", function (done) {
            superagent.get("localhost:21569/auth/authorize/couchdb/testconsumi/testconsumi0101").end(function (err, res) {
                if (err) {
                    done(err);
                }
                else if (res && res.body && !res.body.error) {
                    var obj = res.body;
                    expect(obj).to.be.an('Object');
                    expect(obj.error).to.not.exist;
                    done();
                }
                else {
                    done(res.body.error);
                }
            });
        });
    });
});
after(function () {
    server.close();
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvY291Y2hkYmF1dGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUVBLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFFdEMsSUFBWSxPQUFPLFdBQU0sU0FBUyxDQUFDLENBQUE7QUFDbkMsSUFBWSxVQUFVLFdBQU0sWUFBWSxDQUFDLENBQUE7QUFFekMsc0JBQXVCLFVBQVUsQ0FBQyxDQUFBO0FBR2xDLElBQU0sR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0FBQ3RCLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7QUFNM0MsTUFBTSxDQUFDO0lBRUgsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsZUFBVSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUVqSCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBRXpCLENBQUMsQ0FBQyxDQUFBO0FBR0YsUUFBUSxDQUFDLHdCQUF3QixFQUFFO0lBRS9CLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRTtRQUM3QixJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXBCLEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxVQUFVLElBQUk7WUFDekMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxvRUFBb0UsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQUcsRUFBRSxHQUFHO2dCQUc5RixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNOLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDZCxDQUFDO2dCQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztvQkFFNUMsSUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztvQkFDckIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUMvQixNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO29CQUUvQixJQUFJLEVBQUUsQ0FBQTtnQkFFVixDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNKLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO2dCQUV4QixDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUE7UUFFTixDQUFDLENBQUMsQ0FBQTtJQUdOLENBQUMsQ0FBQyxDQUFBO0FBQ04sQ0FBQyxDQUFDLENBQUE7QUFHRixLQUFLLENBQUM7SUFFRixNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7QUFFbkIsQ0FBQyxDQUFDLENBQUEiLCJmaWxlIjoidGVzdC9jb3VjaGRiYXV0aC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIG1vY2hhIGZyb20gXCJtb2NoYVwiO1xuXG5jb25zdCBleHBlY3QgPSByZXF1aXJlKFwiY2hhaVwiKS5leHBlY3Q7XG5cbmltcG9ydCAqIGFzIGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCAqIGFzIHN1cGVyYWdlbnQgZnJvbSBcInN1cGVyYWdlbnRcIjtcblxuaW1wb3J0IGF1dGhyb3V0ZXIgZnJvbSBcIi4uL2luZGV4XCI7XG5cblxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xuY29uc3Qgc2VydmVyID0gcmVxdWlyZShcImh0dHBcIikuU2VydmVyKGFwcCk7XG5cblxuXG5cblxuYmVmb3JlKGZ1bmN0aW9uICgpIHtcblxuICAgIGFwcC51c2UoJy9hdXRoJywgYXV0aHJvdXRlcih7IHNlY3JldDogXCJ0dFwiLCBhcHBfaWQ6IFwiZW5lcmd5dHJhY2tcIiwgY291Y2hkYjogXCJodHRwczovL2NvdWNobWFuLmtlcm5lbC5vbmxpbmVcIiB9KSk7XG5cbiAgICBzZXJ2ZXIubGlzdGVuKDIxNTY5KTtcblxufSlcblxuXG5kZXNjcmliZShcImF1dGhvcml6ZSB3aXRoIGNvdWNoZGJcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgZGVzY3JpYmUoXCJhdXRob3JpemF0aW9uIG9iamVjdFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudGltZW91dCgzMDAwMCk7XG5cbiAgICAgICAgaXQoXCJ2ZXJpZmljYXRlIGF1dGhvcml6YXRpb25cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIHN1cGVyYWdlbnQuZ2V0KFwibG9jYWxob3N0OjIxNTY5L2F1dGgvYXV0aG9yaXplL2NvdWNoZGIvdGVzdGNvbnN1bWkvdGVzdGNvbnN1bWkwMTAxXCIpLmVuZCgoZXJyLCByZXMpID0+IHtcblxuXG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICBkb25lKGVycik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXMgJiYgcmVzLmJvZHkgJiYgIXJlcy5ib2R5LmVycm9yKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0gcmVzLmJvZHk7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChvYmopLnRvLmJlLmFuKCdPYmplY3QnKTtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KG9iai5lcnJvcikudG8ubm90LmV4aXN0O1xuXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZG9uZShyZXMuYm9keS5lcnJvcilcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgfSlcblxuXG4gICAgfSlcbn0pXG5cblxuYWZ0ZXIoZnVuY3Rpb24gKCkge1xuXG4gICAgc2VydmVyLmNsb3NlKCk7XG5cbn0pXG5cblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
